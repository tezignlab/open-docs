---
sidebar_position: 1
title: Communication
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Iframe plugin

iframe 和主 App 之间通过 postMessage 进行通信。

确保在 嵌入在 slot 里的 iframe 应用 `onMount` 的时候，向主 App 发送 `ready` 事件

```typescript
const IframeApp = () => {
  // onMount
  useEffect(() => {
    // 确保作为 iframe 被嵌入
    if (window.top !== window.self) {
      window.postMessage(
        {
          event: 'ready',
          data: {
            // 传递给主 App 的数据
            greetings: 'hello world',
          },
        },
        '*',
      );
    }
  }, []);
};
```

### Events

- ready
- props
- invoke-function | invoke-function-result

## Component plugin

用户提供的 Component 类型插件在 DAM 里是作为 `Web Component` 嵌入应用的，因此可以使用 Element 原生的事件机制进行通信。

<Tabs>

  <TabItem value="receiver" label="receive-custom-event.tsx" default>

```tsx
const App = () => {
  const elRef = useRef();

  useEffect(() => {
    elRef.current.addEventListener('some-custom-event', (e) => {
      console.log(e.detail);
    });
  }, []);

  return <div ref={elRef}></div>;
};
```

  </TabItem>

  <TabItem value="dispatcher" label="dispatch-custom-event.tsx">

```tsx
const App = () => {
  const elRef = useRef();

  const handleClick = () => {
    // document or elRef.current
    document.dispatchEvent(
      new CustomEvent('some-custom-event', {
        detail: {
          data: 'hello world',
        },
        composed: true, // important! 确保事件穿透 shadow DOM boundary 到 standard DOM.
      }),
    );
  };

  return <button ref={elRef} onClick={handleClick}></button>;
};
```

  </TabItem>

</Tabs>

事件名称 some-custom-event，是由 DAM 不同插槽提供的自定义事件，遵循 HTML 原生事件命名的规则，一般是以 - 分隔。
