---
sidebar_position: 1
title: 数据通信
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Iframe plugin

iframe plugin 和主应用之间通过 postMessage 进行通信。

## 事件

### ready

你的 iframe 应用加载完成之后，向主应用发送 ready 事件，订阅插件的 props， props 会通过 props 事件来发送给你的插件。
主应用在收到 ready 事件后会立即向你的插件发送 props 事件，当插件的 props 更新之后，会再次向你的插件发送 props 事件。

#### 数据类型

```typescript
interface EventReady {
  event: 'ready';
}
```

#### 例子

```typescript
// 确保你的应用已经加载完成。
// 比如在react里可以在`useEffect`里执行，
// 在vue里可以在`onMounted`里执行。
// 以及确认你的应用被嵌入在 iframe 中
if (self !== parent) {
  window.addEventListener('message', (e) => {
    if (e.data.event === 'props') {
      // ...
    }
  });

  window.postMessage(
    {
      event: 'ready',
    },
    '*',
  );
}
```

### props

当你的插件向主应用发送 ready 事件后、以及 props 更新时，主应用会向插件发送 props 事件，来传递最新的插件 props。

#### 数据类型

```typescript
interface EventProps<SlotProps> {
  event: 'props';
  data: SlotProps;
}
```

#### 例子

```typescript
// 确保你的应用已经加载完成。
// 比如在react里可以在`useEffect`里执行，
// 在vue里可以在`onMounted`里执行。
// 以及确认你的应用被嵌入在 iframe 中
if (self !== parent) {
  window.addEventListener('message', (e) => {
    if (e.data.event === 'props') {
      // ...
    }
  });

  window.postMessage(
    {
      event: 'ready',
    },
    '*',
  );
}
```

### invoke-function

iframe plugin 可以通过 invoke-function 事件来调用主应用的方法。

TODO
